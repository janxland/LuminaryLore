(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[371],{8637:function(t,e,i){var n={"./en/common.json":[8679,679],"./en/detail.json":[4140,140],"./en/extensions.json":[4593,593],"./en/home.json":[3976,976],"./en/init.json":[1054,54],"./en/search.json":[7159,497],"./en/settings.json":[860,860],"./en/sidebar.json":[5331,331],"./zh-CN/common.json":[7163,163],"./zh-CN/detail.json":[8159,159],"./zh-CN/extensions.json":[6315,315],"./zh-CN/home.json":[7979,979],"./zh-CN/init.json":[8366,366],"./zh-CN/search.json":[981,981],"./zh-CN/settings.json":[6456,456],"./zh-CN/sidebar.json":[2871,871]};function s(t){if(!i.o(n,t))return Promise.resolve().then(function(){var e=Error("Cannot find module '"+t+"'");throw e.code="MODULE_NOT_FOUND",e});var e=n[t],s=e[0];return i.e(e[1]).then(function(){return i.t(s,19)})}s.keys=function(){return Object.keys(n)},s.id=8637,t.exports=s},4654:function(){},3894:function(t,e,i){"use strict";i.d(e,{$:function(){return l}});var n=i(8422),s=i(2040),r=i(1712),a=i(592),o=i(3636);function l(t){var e;let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},s=null!==(e=r.Z.get("language"))&&void 0!==e?e:o.A9;return n.ZP.resolvedLanguage!==s&&n.ZP.changeLanguage(s),(0,a.$G)(t,i)}n.ZP.use(a.Db).use((0,s.Z)((t,e)=>i(8637)("./".concat(t,"/").concat(e,".json")))).init((0,o.FW)())},3636:function(t,e,i){"use strict";i.d(e,{A9:function(){return n},FW:function(){return a},Mj:function(){return s}});let n="zh-CN",s=[n,"en"],r="common";function a(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:n,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:r;return{supportedLngs:s,fallbackLng:n,lng:t,fallbackNS:r,defaultNS:r,ns:e}}},551:function(t,e,i){"use strict";i.d(e,{Z:function(){return a}});var n=i(9268),s=i(9791),r=i(1816);function a(t){let{className:e}=t;return(0,n.jsx)("div",{className:(0,s.Z)("flex h-full w-full items-center justify-center",e),children:(0,n.jsx)(r.Z,{size:50,className:"animate-spin"})})}},8934:function(t,e,i){"use strict";i.d(e,{Z:function(){return s}});var n=i(9268);function s(t){return(0,n.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 115 50",...t,children:(0,n.jsxs)("g",{fill:"none",stroke:t.color||"#333",strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:5,children:[(0,n.jsx)("path",{d:"M2.5 47.5v-45h20l5 10 5-10h20v45h-15v-30l-10 15-10-15v30h-15"}),(0,n.jsx)("path",{d:"M52.5 17.5v30h30l-15-30h-15M52.5 2.5v15h30v-15h-30M82.5 2.5v45h30v-45h-15v30-30h-15"})]})})}},2874:function(t,e,i){"use strict";let n;i.d(e,{LD:function(){return L},Yh:function(){return M}});var s=i(9268),r=i(3894),a=i(551),o=i(8934);function l(t){let{msg:e}=t;return(0,s.jsx)("div",{className:"flex h-screen items-center justify-center",children:(0,s.jsxs)("div",{className:"flex flex-col items-center",children:[(0,s.jsx)(o.Z,{className:"mb-3",width:110}),(0,s.jsx)(a.Z,{}),(0,s.jsx)("p",{className:"mt-3",children:e})]})})}var u=i(8225),c=i(2458);class h{request(t,e){e||(e={}),e.headers||(e.headers={"Miru-Url":this.webSite}),e.headers["Miru-Url"]||(e.headers={...e.headers,"Miru-Url":this.webSite});let i=this.proxyUrl+t;return(0,c.ZP)(i,e)}latest(t){throw Error("not implement")}search(t,e){throw Error("not implement")}detail(t){throw Error("not implement")}watch(t){throw Error("not implement")}checkUpdate(t){throw Error("not implement")}async getSetting(t){let e=await u.rK.getSetting(this.package,t);return e?e.value:""}customPlayer(t,e,i){i.notice.show="not implement customPlayer"}async registerSetting(t){await u.rK.addSettings({package:this.package,...t,value:t.defaultValue})}load(){}unload(){}constructor(){this.package="",this.proxyUrl="",this.webSite="",this.name="",this.version="",this.lang="",this.script="",this.scriptUrl="",this.author="",this.license="",this.description="",this.type="bangumi",this.nsfw=!1}}var g=i(9155),d=i(6493),y=i(4357);class p{installExtension(t){return new Promise((e,i)=>{let n=function(t){var e;let i=null===(e=t.match(/MiruExtension([\s\S]+?)\/MiruExtension/))||void 0===e?void 0:e[1];if(!i)return;let n={},s=i.split("\n");for(let t=0;t<s.length;t++){let e=s[t];if(e.startsWith("// @")){let t=e.slice(4).split(" ");n[t[0]]=t.slice(1).join(" ").trim()}}return n}(t);if(!n||!(n.name&&n.package&&n.version&&n.webSite&&n.type&&n.lang))return i("扩展元数据错误");n.script=t,t="data:text/javascript;base64,".concat((0,d.cv)(t)),(0,g.C)()&&import(t).then(t=>{let i=new t.default;return Object.assign(i,n),i.proxyUrl=this.proxyUrl,u.Qt.addExtension(n),this.setExtension(i.package,i),i.load(),e(i.package)}).catch(t=>(this.extensionsErrorMap.set(n.package,t),i(t)))})}unloadExtension(t){var e;null===(e=this.extensionsMap.get(t))||void 0===e||e.unload(),this.extensionsMap.delete(t),u.Qt.deleteExtension(t)}getExtension(t){return this.extensionsMap.get(t)}getExtensionsByType(t){return Array.from(this.extensionsMap.values()).filter(e=>e.type===t)}getExtensionsError(t){return this.extensionsErrorMap.get(t)}async init(){let t=await u.Qt.getAllExtensions();await Promise.all(t.map(t=>{this.installExtension(t.script)}))}setExtension(t,e){this.extensionsMap.set(t,e)}constructor(t){this.extensionsMap=new Map,this.extensionsErrorMap=new Map,(0,y.ky)(this),(0,g.C)()&&Object.defineProperty(window,"Extension",{value:h}),(0,y.EH)(()=>{this.proxyUrl=t.getSetting("miruProxy"),this.extensionsMap.forEach((t,e)=>{this.proxyUrl&&(t.proxyUrl=this.proxyUrl)})})}}class f{async init(){let t=JSON.parse(localStorage.getItem("historyTemp")||"[]");await Promise.all(t.reverse().map(async t=>u.Zv.addHistory(t))),localStorage.removeItem("historyTemp"),this.setHistory(await u.Zv.getAllHistory())}setHistory(t){this.history=t}getHistoryByType(t,e){let i=this.history.filter(e=>e.type===t).slice(0,e);return"bangumi"===t?Promise.all(i.map(async t=>{let e=t.cover;if(e){let i=await (await fetch(e)).arrayBuffer(),n=new Blob([i],{type:"image/png"});t.cover=URL.createObjectURL(n)}return t})):i}async addHistory(t){let e=this.historyTemp.findIndex(e=>e.package===t.package&&e.url===t.url),i=this.history.findIndex(e=>e.package===t.package&&e.url===t.url);-1!==e&&this.historyTemp.splice(e,1),-1!==i&&this.history.splice(i,1),this.historyTemp.unshift(t),this.history.unshift(t)}async getHistory(t,e){return this.history.find(i=>i.package===e&&i.url===t)}async clearHistory(){this.history.splice(0,this.history.length),this.historyTemp.splice(0,this.historyTemp.length),await u.Zv.deleteAllHistory(),localStorage.removeItem("historyTemp")}constructor(){this.history=[],this.historyTemp=[],(0,y.ky)(this),(0,y.EH)(()=>{(0,g.C)()&&this.historyTemp.length>0&&localStorage.setItem("historyTemp",JSON.stringify(this.historyTemp))})}}var m=i(1712);class v{async init(){if(!(0,g.C)())return;let t=await u.s$.getAllSettings();t.forEach(t=>{this.setSetting(t.key,t.value)}),this.envItems.set("theme","auto"),this.envItems.set("miruProxy","/api/request"),this.envItems.set("miruRepo","https://mybox-1257251314.cos.ap-chengdu.myqcloud.com/www/repo"),this.envItems.set("kanban","true"),this.envItems.set("TMDBKey",""),this.envItems.set("model","0"),this.envItems.forEach((t,e)=>{this.getSetting(e)||this.setSetting(e,t)})}getSetting(t){return this.items.get(t)}setSetting(t,e){this.items.set(t,e),u.s$.setSettings(t,e)}resetSetting(t){this.setSetting(t,this.envItems.get(t))}constructor(){this.items=new Map,this.envItems=new Map,this.ready=!1,(0,y.ky)(this),(0,y.EH)(()=>{if((0,g.C)()){this.getSetting("language")&&m.Z.set("language",this.getSetting("language"),{expires:365});let t=this.getSetting("theme"),e=()=>document.documentElement.classList.add("dark"),i=()=>document.documentElement.classList.remove("dark");if("auto"===t){let t=window.matchMedia("(prefers-color-scheme: dark)");t.matches?e():i(),t.addEventListener("change",t=>{if("auto"===this.getSetting("theme")){if(t.matches){e();return}i()}})}"dark"===t&&e(),"light"===t&&i()}})}}class w{async request(t,e){for(;!this.key;)await new Promise(t=>setTimeout(t,100));return this.req=(0,c.l7)({prefix:"https://api.themoviedb.org",params:{api_key:this.key,language:m.Z.get("language")}}),this.req(t,e)}async search(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,i=await this.request("/3/search/multi",{params:{query:t,page:e}});return i.results}async getDetails(t,e){let i=await this.request("/3/".concat(e,"/").concat(t));return i}async getCredits(t,e){let i=await this.request("/3/".concat(e,"/").concat(t,"/credits"));return i}getImageUrl(t){return t?"https://image.tmdb.org/t/p/original/".concat(t):void 0}constructor(t){(0,y.EH)(()=>{this.key=t.getSetting("TMDBKey")})}}var x=i(8119);class k{init(){if(!(0,g.C)())return;let t=localStorage.getItem("playlist");if(t){let{playlist:e,index:i}=JSON.parse(t);this.playlist=e,this.index=i}}get currentPlay(){let t=this.index>=this.playlist.length?0:this.index;return this.playlist[t]}addPlay(t){this.playlist.unshift(t),this.index=0}togglePlay(t){this.index=t}pushPlay(t){let e=this.playlist.findIndex(e=>e.url===t.url);-1!==e&&this.playlist.splice(e,1),this.playlist.push(t)}addNextPlay(t){let e=this.playlist.findIndex(e=>e.url===t.url);-1!==e&&this.playlist.splice(e,1),this.playlist.splice(this.index+1,0,t)}toggleNextPlay(){if(this.index+1>=this.playlist.length){(0,x.yv)("已经是最后一集了",{variant:"info"});return}this.index++}togglePrevPlay(){if(this.index-1<0){(0,x.yv)("已经是第一集了",{variant:"info"});return}this.index--}clearPlayList(){this.playlist=[],localStorage.removeItem("playlist")}toggleShowPlayList(t){if(void 0!==t){this.showPlayList=t;return}this.showPlayList=!this.showPlayList}toggleFloatPlayList(t){if(void 0!==t){this.floatPlayList=t;return}this.floatPlayList=!this.floatPlayList}toggleFullScreen(t){if(void 0!==t){this.fullScreen=t;return}this.fullScreen=!this.fullScreen}toggleMini(t){if(void 0!==t){this.mini=t;return}this.mini=!this.mini}constructor(){this.playlist=[],this.fullScreen=!1,this.showPlayList=!0,this.mini=!0,this.index=0,this.floatPlayList=!1,(0,y.ky)(this),this.init(),(0,y.EH)(()=>{(0,g.C)()&&this.playlist.length&&localStorage.setItem("playlist",JSON.stringify({playlist:this.playlist,index:this.index}))})}}class S{async request(t,e){for(;!this.token;)await new Promise(t=>setTimeout(t,100));return this.req=(0,c.l7)({prefix:"https://api.github.com",headers:{Authorization:"Bearer ".concat(this.token)}}),this.req(t,e)}async getRemoteGid(){if(this.gid)return this.gid;let t=await this.request("/gists"),e=t.find(t=>"MiruSync"===t.description);return this.gid=null==e?void 0:e.id,this.gid}async pull(){let t=await this.getRemoteGid();if(!t)return;let e=await this.request("/gists/".concat(t)),i=e.files["MiruSync.json"];return{rawUrl:i.raw_url,updatedAt:e.updated_at}}async push(t){let e;let i=await this.getRemoteGid();return{rawUrl:(i?(e=await this.request("/gists/".concat(i),{method:"PATCH",data:{files:{"MiruSync.json":{content:JSON.stringify(t,null,2)}}}})).files:(e=await this.request("/gists",{method:"POST",data:{description:"MiruSync",public:!1,files:{"MiruSync.json":{content:JSON.stringify(t,null,2)}}}})).files)["MiruSync.json"].raw_url,updatedAt:e.updated_at}}constructor(t){(0,y.ky)(this),this.settingsStore=t,(0,y.EH)(()=>{this.token=t.getSetting("githubToken")})}}class P{constructor(){this.settingsStore=new v,this.tmdbStore=new w(this.settingsStore),this.extensionStore=new p(this.settingsStore),this.historyStore=new f,this.playerStore=new k,this.syncStore=new S(this.settingsStore)}}var E=i(9308),j=i(6006);(0,E.DT)(!g.C),(0,y.jQ)({useProxies:"always"});let b=(0,j.createContext)(void 0);function M(){let t=(0,j.useContext)(b);if(void 0===t)throw Error("useRootStore must be used within RootStoreProvider");return t}let A=function(){let t=null!=n?n:new P;return n||(n=t),t}();function L(t){let{children:e}=t,[i,n]=(0,j.useState)(!1),{t:a}=(0,r.$)("init"),[o,u]=(0,j.useState)();return((0,j.useEffect)(()=>{(0,g.C)()&&(u(a("initializing")),(async()=>{u(a("initialization-settings")),await A.settingsStore.init(),u(a("initialization-extensions")),await A.extensionStore.init(),u(a("initialization-historys")),await A.historyStore.init(),n(!0)})())},[]),i)?(0,s.jsx)(b.Provider,{value:A,children:e}):(0,s.jsx)(l,{msg:o})}},8225:function(t,e,i){"use strict";i.d(e,{db:function(){return h},u1:function(){return g},Qt:function(){return n},rK:function(){return s},Zv:function(){return r},dk:function(){return d},c8:function(){return a},s$:function(){return o},mI:function(){return l}});var n,s,r,a,o,l,u=i(5028);!function(t){async function e(t){let e=await i(t.package);return e?h.extension.where("package").equals(t.package).modify(t):h.extension.add(t)}function i(t){return h.extension.where("package").equals(t).first()}t.getAllExtensions=function(){return h.extension.toArray()},t.getAllExtensionsForType=function(t){return h.extension.where("type").equals(t).toArray()},t.deleteExtension=function(t){return h.extension.where("package").equals(t).delete()},t.addExtension=e,t.getExtension=i}(n||(n={})),function(t){function e(t,e){return h.extensionSettings.where("package").equals(t).and(t=>t.key===e).first()}async function i(t){let i=await e(t.package,t.key);return i?h.extensionSettings.where("package").equals(t.package).and(e=>e.key===t.key).modify({title:t.title,type:t.type,options:t.options,defaultValue:t.defaultValue,description:t.description}):h.extensionSettings.add(t)}t.getSettings=function(t){return h.extensionSettings.where("package").equals(t).toArray()},t.getSetting=e,t.setSetting=function(t,e,i){return h.extensionSettings.where("package").equals(t).and(t=>t.key===e).modify({value:i})},t.addSettings=i,t.deleteExtensionSettings=function(t){return h.extensionSettings.where("package").equals(t).delete()}}(s||(s={})),function(t){async function e(){return h.history.reverse().sortBy("time")}async function i(t){return(t.time=Date.now(),await n(t.url,t.package))?h.history.where({url:t.url,package:t.package}).modify(t):h.history.add(t)}function n(t,e){return h.history.where({url:t,package:e}).first()}t.getAllHistory=e,t.getAllHistoryByType=function(t,e){return h.history.where("type").equals(t).reverse().limit(e).sortBy("time")},t.addHistory=i,t.deleteHistory=function(t,e){return h.history.where({package:t,url:e}).delete()},t.deleteAllHistory=function(){return h.history.clear()},t.getHistory=n}(r||(r={})),function(t){function e(t){return h.love.add(t)}async function i(t){let i=await a.isLove(t.package,t.url);return i?n(t.package,t.url):e(t)}function n(t,e){return h.love.where({package:t,url:e}).delete()}function s(t,e){return h.love.where({package:t,url:e}).first()}async function r(t,e){return!!await s(t,e)}t.getAllLove=function(){return h.love.toArray()},t.getAllLoveByType=function(t){return h.love.where("type").equals(t).reverse().toArray()},t.addLove=e,t.loveOrUnLove=i,t.deleteLove=n,t.deleteAllLove=function(){return h.love.clear()},t.getLove=s,t.isLove=r}(a||(a={})),function(t){function e(t){return h.settings.where("key").equals(t).first()}async function i(t,i){return await e(t)?h.settings.where("key").equals(t).modify({value:i}):h.settings.add({key:t,value:i})}t.getAllSettings=function(){return h.settings.toArray()},t.getSettings=e,t.setSettings=i,t.deleteSettings=function(t){return h.settings.where("key").equals(t).delete()},t.deleteAllSettings=function(){return h.settings.clear()}}(o||(o={})),function(t){function e(t,e){return h.tmdb.where({pkg:t,url:e}).first()}async function i(t){let i=await e(t.pkg,t.url);return i?h.tmdb.update(i.id,t):h.tmdb.add(t)}t.getTMDB=e,t.saveTMDB=i}(l||(l={}));class c extends u.ZP{constructor(){super("MiruDB"),this.version(5).stores({history:"++id, url, title, package, cover, type, time,&[url+package]",extension:"++id, id, name, &package, version, lang, type, script, enable, description, webSite, scriptUrl, author, icon, settings",love:"++id, title, package, url, cover, type,&[url+package]",settings:"++id, &key, value",extensionSettings:"++id, title, package, key, value, type, options, defaultValue, description, &[package+key]",tmdb:"++id, tmdb_id, mediaType, pkg, url,&[url+pkg]"})}}let h=new c;function g(){return Promise.all([h.history.toArray(),h.extension.toArray(),h.love.toArray(),h.settings.toArray(),h.extensionSettings.toArray(),h.tmdb.toArray()])}function d(t){return Promise.all([h.history.bulkPut(t[0]),h.extension.bulkPut(t[1]),h.love.bulkPut(t[2]),h.settings.bulkPut(t[3]),h.extensionSettings.bulkPut(t[4]),h.tmdb.bulkPut(t[5])])}},9155:function(t,e,i){"use strict";function n(){return!0}i.d(e,{C:function(){return n}})}}]);